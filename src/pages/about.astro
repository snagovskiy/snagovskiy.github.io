---
import MainLayout from '../layouts/MainLayout.astro';
import { client } from '../lib/prismic';
import { asText, asHTML } from '@prismicio/helpers';

// Получаем данные навигации (меню) из Prismic
const navigation = await client.getSingle('navigation');

// Получаем данные страницы "Об авторе" из Prismic (тип 'aboutpage')
const aboutPage = await client.getSingle('aboutpage');

// Извлекаем данные
const avatarUrl = aboutPage.data.avatar?.url || '/images/avatar.jpg';
const avatarAlt = aboutPage.data.avatar?.alt || 'Фотограф StreetFrame';
const title = asText(aboutPage.data.title) || 'Привет, я фотограф StreetFrame';
const descriptionHTML = asHTML(aboutPage.data.description) || '';

// Обрабатываем блоки деталей (повторяемая группа)
const details = aboutPage.data.details?.map(block => ({
  title: asText(block.detail_title) || '',
  listHTML: asHTML(block.detail_list) || ''
})) || [];

// Контактная информация
const contactTitle = asText(aboutPage.data.contact?.contact_title) || 'Контакты';
const email = aboutPage.data.contact?.email || 'muzaboz@proton.me';
const note = aboutPage.data.contact?.note || 'Отвечаю в течение пары дней';
---

<MainLayout 
  navigation={navigation}
  title="Об авторе - StreetFrame"
  description="История уличного фотографа, который начал свой путь в 2006 году с пленочных камер и продолжает снимать городские пейзажи на современный смартфон."
>
  <section class="about-section">
    <div class="about-content">
      <div class="about-image">
        <img 
          src={avatarUrl}
          alt={avatarAlt}
          class="about-avatar"
          width="400"
          height="400"
        />
      </div>
      
      <div class="about-text">
        <h1 class="about-title">{title}</h1>
        
        {descriptionHTML && (
          <div class="about-description" set:html={descriptionHTML} />
        )}
        
        {details.length > 0 && (
          <div class="about-details">
            {details.map((block, index) => (
              <div class="detail-item" key={index}>
                <h3 class="detail-title">{block.title}</h3>
                {block.listHTML && (
                  <div class="detail-list" set:html={block.listHTML} />
                )}
              </div>
            ))}
          </div>
        )}
        
        <div class="contact-info">
          <h3 class="contact-title">{contactTitle}</h3>
          <p>Для связи и вопросов: <a href={`mailto:${email}`} class="contact-link">{email}</a></p>
          {note && <p class="contact-note">{note}</p>}
        </div>
      </div>
    </div>
  </section>
</MainLayout>

<style>
  .about-section {
    padding: 2rem 0;
  }
  
  .about-content {
    display: flex;
    flex-direction: column;
    gap: 3rem;
  }
  
  .about-image {
    text-align: center;
  }
  
  .about-avatar {
    width: 100%;
    max-width: 400px;
    height: auto;
    border-radius: 50%;
    object-fit: cover;
    box-shadow: var(--card-shadow);
  }
  
  .about-title {
    font-size: 2.2rem;
    margin-bottom: 1.5rem;
    color: var(--text-primary);
    line-height: 1.2;
  }
  
  .about-description {
    font-size: 1.1rem;
    line-height: 1.7;
    color: var(--text-secondary);
    margin-bottom: 2rem;
  }
  
  .about-description p {
    margin-bottom: 1.5rem;
  }
  
  .about-details {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    margin-bottom: 2rem;
  }
  
  .detail-item {
    background-color: var(--bg-secondary);
    padding: 1.5rem;
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
    transition: transform 0.3s ease;
  }
  
  .detail-item:hover {
    transform: translateY(-3px);
  }
  
  .detail-title {
    font-size: 1.3rem;
    margin-bottom: 1rem;
    color: var(--accent-color);
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 0.5rem;
  }
  
  .detail-list {
    list-style: none;
    padding-left: 0;
  }
  
  .detail-list li {
    margin-bottom: 0.75rem;
    padding-left: 1.8rem;
    position: relative;
    line-height: 1.5;
  }
  
  .detail-list li::before {
    content: "•";
    color: var(--accent-color);
    position: absolute;
    left: 0;
    font-size: 1.5rem;
    line-height: 1;
  }
  
  .contact-info {
    background-color: var(--bg-secondary);
    padding: 1.5rem;
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
    text-align: center;
  }
  
  .contact-title {
    font-size: 1.3rem;
    margin-bottom: 1rem;
    color: var(--accent-color);
  }
  
  .contact-link {
    color: var(--accent-color);
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s ease;
  }
  
  .contact-link:hover {
    text-decoration: underline;
    color: var(--accent-hover);
  }
  
  .contact-note {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-top: 0.5rem;
  }
  
  @media (min-width: 768px) {
    .about-content {
      flex-direction: row;
      align-items: flex-start;
    }
    
    .about-image {
      flex: 0 0 350px;
      position: sticky;
      top: 100px;
    }
    
    .about-text {
      flex: 1;
    }
    
    .about-details {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  @media (max-width: 767px) {
    .about-title {
      font-size: 1.8rem;
      text-align: center;
    }
    
    .detail-item:hover {
      transform: none;
    }
  }
</style>