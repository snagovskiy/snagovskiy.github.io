---
import ThemeToggle from './ThemeToggle.astro';
import MobileMenu from './MobileMenu.astro';

export interface Props {
  navigation?: any;
}

const { navigation } = Astro.props;

// Запасное меню
const defaultMenuItems = [
  { label: 'Главная', link: { type: 'Web', url: '/' } },
  { label: 'Пейзажи', link: { type: 'Web', url: '/landscapes' } },
  { label: 'Об авторе', link: { type: 'Web', url: '/about' } }
];

const menuItems = navigation?.data?.menu_items || defaultMenuItems;

// Универсальная функция получения URL из ссылки Prismic
function getLinkUrl(link) {
  if (!link) return '#';
  
  // Если ссылка внешняя (Web)
  if (link.link_type === 'Web' && link.url) {
    return link.url;
  }
  
  // Если ссылка на документ
  if (link.link_type === 'Document' && link.uid) {
    // Определяем тип документа и строим путь
    const type = link.type;
    if (type === 'homepage') return '/';
    if (type === 'landscapes') return '/landscapes';
    if (type === 'about') return '/about';
    // Если тип не известен, используем uid
    return `/${link.uid}`;
  }
  
  return '#';
}
---

<header class="header">
  <div class="container header-container">
    <div class="logo">
      <a href="/" class="logo-link">
        <!-- Встроенный SVG логотип (полностью сохранён) -->
        <svg class="logo-image" width="140" height="32" viewBox="0 0 180 40" fill="none" xmlns="http://www.w3.org/2000/svg">
  <!-- Смартфон / Мобильный телефон (символ мобильной фотографии) -->
  <g>
    <!-- Корпус смартфона -->
    <rect x="2" y="6" width="28" height="36" rx="6" fill="var(--accent-color)" opacity="0.15"/>
    <rect x="4" y="8" width="24" height="32" rx="4" fill="var(--bg-secondary)"/>
    <!-- Экран с фотоаппаратом внутри -->
    <rect x="6" y="10" width="20" height="20" rx="2" fill="var(--accent-color)" opacity="0.1"/>
    <circle cx="16" cy="20" r="5" fill="var(--accent-color)" opacity="0.3"/>
    <circle cx="16" cy="20" r="2.5" fill="var(--accent-color)"/>
    <!-- Камера сзади (модуль) -->
    <circle cx="22" cy="14" r="2" fill="var(--accent-color)"/>
    <!-- Кнопка домой / вырез -->
    <circle cx="16" cy="33" r="1.5" fill="var(--border-color)"/>
  </g>
  
  <!-- Связь времен: пленка -> цифра (декоративная полоска) -->
  <g>
    <rect x="32" y="20" width="10" height="2" rx="1" fill="var(--accent-color)" opacity="0.5"/>
    <circle cx="37" cy="21" r="1" fill="var(--accent-color)"/>
  </g>
  
  <!-- Текст StreetFrame (оставляем как есть) -->
  <g>
    <text x="44" y="24" font-family="Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif" font-size="20" font-weight="700" fill="var(--text-primary)">Street</text>
    <text x="104" y="24" font-family="Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif" font-size="20" font-weight="700" fill="var(--accent-color)">Frame</text>
  </g>
  
  <!-- Подпись "mobile photography" -->
  <text x="44" y="34" font-family="Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif" font-size="8" font-weight="400" fill="var(--text-secondary)" letter-spacing="0.3">MOBILE • STREET • SINCE 2006</text>
</svg>
      </a>
    </div>
    
    <!-- Десктопное меню – теперь динамическое -->
   <nav class="desktop-nav">
      <ul class="nav-list">
        {menuItems.map((item, index) => (
          <li class="nav-item" key={index}>
            <a href={getLinkUrl(item.link)} class="nav-link">
              {item.label}
            </a>
          </li>
        ))}
      </ul>
    </nav>
    
    <div class="header-controls">
      <ThemeToggle />
      <MobileMenu navigation={navigation} />
    </div>
  </div>
</header>

<style>
  .header {
    background-color: var(--bg-secondary);
    box-shadow: var(--header-shadow);
    position: sticky;
    top: 0;
    z-index: 1000;
    padding: 0.75rem 0;
    transition: background-color var(--transition-speed);
    width: 100%;
  }
  
  .header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
  }
  
  .logo {
    display: flex;
    align-items: center;
    flex-shrink: 0;
  }
  
  .logo-link {
    display: block;
    line-height: 0;
  }
  
  .logo-image {
    display: block;
    height: 32px;
    width: auto;
    transition: opacity 0.3s ease;
  }
  
  /* Десктопное меню */
  .desktop-nav {
    display: none; /* Скрыто на мобильных */
  }
  
  .nav-list {
    display: flex;
    list-style: none;
    gap: 2rem;
    margin: 0;
    padding: 0;
  }
  
  .nav-item {
    margin: 0;
    padding: 0;
  }
  
  .nav-link {
    text-decoration: none;
    color: var(--text-primary);
    font-weight: 500;
    transition: color var(--transition-speed);
    padding: 0.5rem 0;
    position: relative;
    font-size: 1rem;
  }
  
  .nav-link:hover {
    color: var(--accent-color);
  }
  
  .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background-color: var(--accent-color);
    transition: width var(--transition-speed);
  }
  
  .nav-link:hover::after {
    width: 100%;
  }
  
  /* Панель управления (кнопки) */
  .header-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-shrink: 0;
  }
  
  /* Десктопная версия (шире 768px) */
  @media (min-width: 769px) {
    .header {
      padding: 1rem 0;
    }
    
    .logo-image {
      height: 40px;
    }
    
    .desktop-nav {
      display: block; /* Показываем на десктопе */
    }
    
    .header-controls {
      gap: 0.75rem;
    }
  }
  
  /* Маленькие мобильные */
  @media (max-width: 480px) {
    .logo-image {
      height: 28px;
    }
    
    .header-controls {
      gap: 0.25rem;
    }
  }
</style>